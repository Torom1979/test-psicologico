{% extends 'psicologos/base.html' %}
{% block page_content %}

<title>Tests Psicológicos</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<script>
    function generarLink(slug) {
        fetch(`/tests/generar_link/${slug}/`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                } else {
                    const input = document.getElementById("link-" + slug);
                    input.value = data.link;

                    // Intentar copiar usando Clipboard API moderna
                    navigator.clipboard.writeText(data.link)
                        .then(() => {
                            // Mostrar toast si se copió correctamente
                            const toastElement = document.getElementById('toast-copiado');
                            const toast = new bootstrap.Toast(toastElement);
                            toast.show();
                        })
                        .catch(err => {
                            // Si falla, seleccionar el texto como respaldo
                            input.select();
                            input.setSelectionRange(0, 99999);
                            document.execCommand("copy");
                            alert("El navegador no permite copiar automáticamente. Copia manualmente.");
                        });
                }
            });
    }
</script>


<body class="container mt-4">
    <h1 class="text-center mb-4">Generar Link para Tests Psicológicos</h1>
    
    <div class="row">
        {% for test in tests %}
        <div class="col-md-6 mb-3">
            <div class="card shadow">
                <div class="card-body text-center">
                    <h4>{{ test.nombre }}</h4>
                    <button class="btn btn-success mt-2" onclick="generarLink('{{ test.slug }}')">
                        Generar y Copiar Link
                    </button>
                    <input type="text" id="link-{{ test.slug }}" class="form-control mt-2 text-center" readonly>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Toast Bootstrap -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="toast-copiado" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">
                    ¡Link copiado al portapapeles!
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

{% endblock %}
{% block js_page %}{% endblock %}
